#{extends 'main.html' /}
#{set title:'PubMed Watcher - Feed' /}
#{script 'pubmed-loader.js' /}

#{set email:email /}
#{menu '.home-link' /}

<div class="container">
	
	<div class="row-fluid">
	#{list items:keyArticles, as:'keyArticle'}
		#{keyArticle keyArticle /}
	#{/list}
	
	%{
 	 	for(int i = keyArticles.size(); i < 4; i++) { 
	}%
 	 	#{GhostKeyArticle /}
	%{
 		 }
	}%
	</div>

	<div class="row-fluid" style="margin-bottom: 15px;">
	%{
	  for(int i = 0; i < keyArticles.size(); i++) {
	}%
 	 <div class="span3 text-center">
 	 	<a href="@{Application.removeKeyArticle(keyArticles.get(i).id)}" class="btn delete-article-action" type="button">
  			<span><i class="icon-trash"></i> delete article</span>
  			<img style="display: none;" class="loader" src="@{'/public/images/ajax-loader.gif'}" />
  		</a>
  	</div>
	%{
 	 }
	}%

	%{
 	 	for(int i = keyArticles.size(); i < 4; i++) { 
	}%
 	 <div class="span3 text-center">
 	 	<a href="@{Application.addKeyArticle()}" class="btn" type="button">
  			<i class="icon-file"></i> add article
  		</a>
  	</div>
	%{
 		 }
	}%
</div>

</div>

#{if relatedArticles.size() < 1}
<div class="container text-center">
	<div class="well">
		<h1>Welcome!</h1>
		<p>Thanks for registring, here is what you need to know to get quickly started:</p>
		<h2>Step 1 - Add a Key Article</h2>
		<p class="lead">Define your research topic by setting up to four Key Articles. For instance you can use your
		own work as input or the papers of the lab you are working in at the moment. Key Articles represent the 
		science you care about. They must be referenced on <a href="http://www.ncbi.nlm.nih.gov/pubmed/">PubMed</a>.</p>
		<p></p>
		<h2>Step 2 - Read relevant stuff!</h2>
		<p class="lead">A Key Article is the only concept you need to understand. </p>
	</div>
</div>
#{/if}


<div class="container" id="related-articles">
#{list items:relatedArticles, as:'relatedArticle'}
<div class="well" style="display: none;" id="${relatedArticle.pmid}" data-score="${Math.round(relatedArticle.standardizedSimilarity)}" data-id="${relatedArticle.id}">
<a href="@{Application.markAsRead(relatedArticle.id)}" class="btn pull-right btn-mini markasread">
<i class="icon-eye-open"></i> mark as read</a>
</div>
#{/list}
</div>

<div class="container text-center" style="margin-bottom: 20px;">
	<button id="showMoreRelatedArticles" class="btn btn-large show-more" data-pagination="${relatedArticles.size()}" type="button" style="display: none;">
		show more
	</button>
</div>

<script type="text/javascript">
$(document).ready(function() {
	loadDocuments('${pmids}');
	var maxHeight = 0;
	$('.key-article').each(function(){
		if($(this).height() > maxHeight){
			maxHeight = $(this).height();
		}
	});
	
	$('.key-article').each(function(){
		$(this).height(maxHeight);
	});
	
	$('.delete-article-action').click(function() {
		$(this).find('span').hide();
		$(this).find('img').show();
	});
	
});
</script>
